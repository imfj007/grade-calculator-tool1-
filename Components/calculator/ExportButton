
import React, { useState } from "react";
import { Button } from "@/components/ui/button";
import { Download, FileImage, FileSpreadsheet, Copy } from "lucide-react";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";

export default function ExportButton({ gradeData, totalQuestions, showDecimals }) {
  const [isExporting, setIsExporting] = useState(false);
  const [copyStatus, setCopyStatus] = useState('Copy');

  const exportAsCSV = () => {
    setIsExporting(true);
    
    const data = [];
    for (let wrong = 0; wrong <= totalQuestions; wrong++) {
      const correct = totalQuestions - wrong;
      const percentage = totalQuestions > 0 ? (correct / totalQuestions) * 100 : 0;
      const displayPercentage = showDecimals 
        ? percentage.toFixed(2) 
        : Math.round(percentage);
      
      data.push({
        'Wrong Answers': wrong,
        'Correct Answers': correct,
        'Grade': `${displayPercentage}%`,
        'Fraction': `${correct}/${totalQuestions}`
      });
    }

    const headers = Object.keys(data[0]);
    const csvContent = [
      headers.join(','),
      ...data.map(row => headers.map(header => `"${row[header]}"`).join(','))
    ].join('\n');

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `grade-chart-${totalQuestions}-questions.csv`);
